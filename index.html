<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Box Blockly - 让岛民没有难写的代码！</title>
    <link rel="shortcut icon" href="https://box3.codemao.cn/favicon.ico" />
  </head>
  <body onload="loadfuncs()">
    <!-- 导入高亮块 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <link href="./codehljscss.css" rel="stylesheet" />
    <!-- 导入GoogleBlockly -->
    <script src="./blockly/blockly_compressed.js"></script>
    <script src="./blockly/blocks_compressed.js"></script>
    <script src="./blockly/zh-hans.js"></script>
    <script src="./blockly/javascript_compressed.js"></script>
    <!-- 导入Blockly定义块 -->
    <script src="./block.js"></script>
    <!-- 导入 zh_CN 积木块消息配置 -->
    <script src="./msg_zh.js"></script>
    <noscript>You need start JavaScript to run this web.</noscript>
    <div class="loding">
      <div></div>
      <font>Box Blockly</font>
      <span id="lodingtext"></span>
      <script>
        (async function () {
          const data = [
            "让岛民没有难写的代码！",
            "1086科技工作室致力制作",
            "感谢您的使用",
            "感谢您对我们的支持",
          ];
          document.getElementById("lodingtext").innerText =
            data[~~(Math.random() * data.length)];
        })();
      </script>
      <style>
        :root {
          --theme-color: #ff6a00;
          --theme-button-hover: #ff9a52;
          --theme-button-active: #cc5500;
        }
        .loding {
          position: absolute;
          width: 100%;
          height: 100%;
          background-color: var(--theme-color);
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          user-select: none;
          color: #fff;
          z-index: 99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999;
        }
        .loding font {
          font-size: 50px;
        }
        .loding span {
          font-size: 20px;
        }
        .loding div {
          width: 80px;
          height: 80px;
          border: solid 8px var(--theme-color);
          border-top: solid 8px;
          border-radius: 50%;
          -webkit-animation: lodingAnimationWeb 0.5s linear infinite;
          animation: lodingAnimationWeb 0.5s linear infinite;
          margin-bottom: 50px;
        }
        @-webkit-keyframes lodingAnimationWeb {
          25% {
            transform: rotate(90deg);
          }
          50% {
            transform: rotate(180deg);
          }
          75% {
            transform: rotate(270deg);
          }
          100% {
            transform: rotate(360deg);
          }
        }
        @keyframes lodingAnimationWeb {
          25% {
            transform: rotate(90deg);
          }
          50% {
            transform: rotate(180deg);
          }
          75% {
            transform: rotate(270deg);
          }
          100% {
            transform: rotate(360deg);
          }
        }
      </style>
    </div>
    <div id="app">
      <div id="blocklyDiv" style="width: 60%"></div>
      <div id="bcodeshow"></div>
      <style>
        body {
          overflow: hidden;
        }
        * {
          margin: 0;
        }
        #app {
          width: 100%;
          height: 100%;
          display: flex;
          flex-direction: row;
        }
        #bcodeshow {
          width: 40%;
          height: 900px;
          padding: 10px;
          background: #fff;
          color: #000;
          font-family: Menlo, Monaco, "Courier New", monospace;
          border-left: double #aaa;
          overflow: auto;
        }
        #bcodeshow::-webkit-scrollbar {
          height: 5px;
          width: 5px;
        }
        #bcodeshow::-webkit-scrollbar-thumb {
          background: #aaa5;
        }
        #bcodeshow::-webkit-scrollbar-thumb:hover {
          background: #aaa;
        }
        #bcodeshow::-webkit-scrollbar-thumb:active {
          background: #aaa3;
        }
        #bcodeshow::-webkit-scrollbar-track {
          background: #0000;
        }
        .blocklyTreeRow {
          margin: 0;
          padding: 5px;
          cursor: pointer;
        }
        .blocklyTreeRow.blocklyTreeSelected {
          background-color: var(--theme-color);
        }
      </style>
      <!-- 复制代码的按钮 -->
      <div>
        <div id="copycodebtn">复制</div>
        <style>
          #copycodebtn {
            padding: 20px;
            font-size: 25px;
            background-color: var(--theme-color);
            border-radius: 50%;
            color: #fff;
            box-shadow: 0px 10px 20px #aaa;
            transition: 0.3s;
            position: fixed;
            bottom: 50px;
            right: 50px;
            user-select: none;
            cursor: pointer;
          }
          #copycodebtn:hover {
            box-shadow: 0px 10px 25px #ccc;
            background-color: var(--theme-button-hover);
          }
          #copycodebtn:active {
            box-shadow: 0px 10px 25px #ccc;
            background-color: var(--theme-button-active);
          }
        </style>
        <script>
          var copybtn = document.getElementById("copycodebtn");
          copybtn.onclick= async () => {
              await navigator.clipboard.writeText(
               "//代码由 " +
                window.location.href +
                " 生成，感谢您对我们的支持。\n" +
                Blockly.JavaScript.workspaceToCode(workspace)
              );
              window.alert("代码复制成功");
          };
        </script>
      </div>
    <!-- 积木xml -->
    <xml id="toolbox" style="display: none">
      <category name="事件" expanded="true" colour="#5b80a5">
        <block type="world_onPlayerJoin"></block>
        <block type="world_onPlayerJoin_entity"></block>
        <block type="world_onEntityDestroy"></block>
        <block type="world_onEntityDestroy_entity"></block>
        <block type="world_onInteract"></block>
        <block type="world_onInteract_entity"></block>
        <block type="world_onInteract_targetEntity"></block>
        <block type="world_onClick_entity"></block>
        <block type="world_onInteract_clicker"></block>
        <block type="world_onInteract_button"></block>
        <block type="world_onVoxelContact"></block>
        <block type="world_onVoxelContact_entity"></block>
        <block type="world_onVoxelContact_voxel"></block>
        <block type="world_onFluidEnter"></block>
        <block type="world_onFluidEnter_entity"></block>
        <block type="world_onFluidEnter_voxel"></block>
      </category>
      <category name="控制" expanded="true" colour="#8ca6c0">
        <block type="controls_if"></block>
        <block type="controls_repeat_ext"><value name="TIMES"><block type="math_number"><field name="NUM">10</field></block></value></block>
        <block type="controls_whileUntil"></block>
        <block type="controls_for">
          <field name="VAR" id="57g(4![Bc(~B67SRUvvd">i</field>
          <value name="FROM">
            <block type="math_number">
              <field name="NUM">1</field>
            </block>
          </value>
          <value name="TO">
            <block type="math_number">
              <field name="NUM">10</field>
            </block>
          </value>
          <value name="BY">
            <block type="math_number">
              <field name="NUM">1</field>
            </block>
          </value>
        </block>
        <block type="controls_forEach"><field name="VAR" id="=ea2SQ,8Dye^#~zQHfJV">j</field></block>
        <block type="controls_flow_statements"></block>
        <block type="box3_sleep"><value name="object"><block type="math_number"><field name="NUM">1</field></block></value></block>
      </category>
      <category name="世界" expanded="true" colour="#5b67a5">
        <block type="world_projectname"></block>
        <block type="world_url"></block>
        <block type="world_say"><value name="MESSAGE"><block type="text"></block></value></block>
        <block type="world_currentTick"></block>
      </category>
      <category name="地形" expanded="true" colour="#8cc08c">
        <block type="voxels_types"></block>
        <block type="voxels_typesid"></block>
        <block type="voxels_setid"></block>
        <block type="voxels_setname"></block>
        <block type="voxels_get"></block>
        <block type="voxels_Rotation"></block>
        <block type="voxels_id"></block>
        <block type="voxels_name"></block>
      </category>
      <category name="实体" expanded="true" colour="#6d5ba5">
        <block type="world_entityQuota"></block>
        <block type="world_worldentitylength"></block>
      </category>
      <category name="玩家" expanded="true" colour="#6d5ba5">
        
      </category>>
      <category name="声音" expanded="true" colour="#6d5ba5">
        
      </category>
      <category name="变量" expanded="true" colour="#a55b80" custom="VARIABLE"></category>
      <category name="列表" expanded="true" colour="#745ba5">
        <block type="lists_create_with"><mutation items="1"></block>
        <block type="lists_create_with"><mutation items="3"></block>
        <block type="lists_repeat"></block>
        <block type="lists_length">
        <block type="lists_isEmpty">
        <block type="lists_indexOf"></block>
        <block type="lists_getIndex"></block>
        <block type="lists_setIndex"></block>
        <block type="lists_getSublist"></block>
        <block type="lists_split"></block>
        <block type="lists_sort"></block>
      </category>
      <category name="字典" expanded="true" colour="#745ba5">
        <!--by小宏-->
        <block type="object_null"></block>
        <block type="object_set"></block>
        <block type="object_get"></block>
        <block type="object_copy"></block>
        <block type="object_inc"></block>
        <block type="object_geto"></block>
        <block type="object_delete"></block>
        <block type="object_freeze"></block>
        <block type="object_isfreeze"></block>
      </category>
      <category name="字符串" expanded="true" colour="#5ba58c">
        <block type="text"></block>
        <block type="text_join"><mutation items="3"></block>
        <block type="text_append"></block>
        <block type="text_length"></block>
        <block type="text_isEmpty"></block>
        <block type="text_indexOf"></block>
        <block type="text_charAt"> </block>
        <block type="text_getSubstring"> </block>
        <block type="text_changeCase"> </block>
        <block type="text_trim"></block>
        <block type="text_prompt_ext"></block>
      </category>
      <category name="运算" expanded="true" colour="#5b67a5">
        <block type="math_number"></block>
        <block type="math_arithmetic"></block>
        <block type="math_single"></block>
        <block type="math_trig"></block>
        <block type="math_constant"></block>
        <block type="math_number_property"></block>
        <block type="math_round"></block>
        <block type="math_on_list"></block>
        <block type="math_modulo"></block>
        <block type="math_constrain"></block>
        <block type="math_random_int"></block>
        <block type="math_random_float"/></block>
      </category>
      <category name="罗辑" expanded="true" colour="#5b80a5">
        <block type="logic_compare"></block>
        <block type="logic_operation"></block>
        <block type="logic_boolean"></block>
        <block type="logic_null">
        <block type="logic_ternary">
      </category>
      <category name="Box3" expanded="true" colour="#a56d5b">
        <label text="代码"></label>
        <block type="box3_runcode1">
        <block type="box3_runcode2">
        <block type="box3_require">
        <label text="控制台"></label>
        <block type="console_clear">
        <block type="console_log">
        <block type="console_error">
        <block type="console_warn">
        <label text="向量"></label>
        <block type="box3_vector">
        <label text="区域"></label>
        <block type="box3_bounds">
        <label text="四元数"></label>
        <block type="box3_quaternion">
        <label text="色彩"></label>
        <block type="box3_rgbcolor">
        <block type="box3_rgbacolor">
        <label text="音效"></label>
        <block type="box3_sound">
      </category>
      <category name="其他" expanded="true" colour="#5ba55b">
        
      </category>
      <category name="函数" expanded="true" colour="#995ba5" custom="PROCEDURE"></category>
      <category name="数据库" colour="#5b67a5">
        <label text="数据库2022/08/16开肝"></label>
      </category>
    </xml>
    <script>
      function loadfuncs() {
        document.getElementsByClassName("loding")[0].style.display = "none";
      }
      var workspace = Blockly.inject("blocklyDiv", {
        toolbox: document.getElementById("toolbox"),
        zoom: {//缩放设置
          controls: false,//显示缩放按钮控件
          wheel: false,//允许使用鼠标滚轮缩放
          startScale: 1,//初始积木大小
          maxScale: 3,//最大大小
          minScale: 0.3,//最小大小
          scaleSpeed: 1,//缩放速度
          Pinch: true,//在移动端允许两根手指捏合缩放
        },
        grid: {//网格设置
          spacing: 20,//间隔
          length: 2,//大小
          colour: '#ccc',//颜色
          snap: true,//当积木碰到一起时是否自动撞开
        },
        move:{//移动设置
          scrollbars: true,//显示滑动条
          drag: true,//允许拖拽移动
          wheel: true,//允许鼠标滚轮滑动
        },
        collapse: true,//允许折叠块
        comments: true,//允许注释块
        sounds: true,//有音效
        trashcan: true,//显示垃圾桶
        maxTrashcanContents: 100,//垃圾桶最大含量
        media: "https://static.codemao.cn/blockly/media/",//资源文件链接（这里用kitten4的）
      });
    </script>
    <script>
      const $ = (s) => {
        return document.querySelector(s);
      };
      async function sleep(ms) {
        const tms = ms || 0;
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve();
          }, tms);
        });
      }
      document.getElementById("bcodeshow").innerHTML =
        `<span class="hljs-comment">//代码由 ` +
        window.location.href +
        ` 生成，感谢您对我们的支持。<br></span>`;
      function myUpdateFunction(event) {
        var code = Blockly.JavaScript.workspaceToCode(workspace);
        var html = hljs
          .highlight(
            "//代码由 " +
              window.location.href +
              " 生成，感谢您对我们的支持。\n" +
              code,
            { language: "JavaScript" }
          )
          .value.split("\n")
          .join("<br>")
          .split("  ")
          .join("&nbsp;&nbsp;")
         document.getElementById("bcodeshow").innerHTML = html
      }
      workspace.addChangeListener(myUpdateFunction);
      setInterval(() => {
        const h = document.documentElement.clientHeight;
        document.getElementById("bcodeshow").style.height = String(h + "px");
        document.getElementsByClassName(
          "blocklyScrollbarHorizontal"
        )[0].style.transform = `translate(80.5px, calc(${h}px - 15px))`;
        document.getElementsByClassName(
          "blocklySvg"
        )[0].attributes.height.value=`${h}px`;
        document.getElementById("blocklyDiv").style.height = String(h + "px");
      }, 1);
    </script>
    <!--右键菜单-->
    <style>
      .xh-menu-background {
        background: #0000;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        z-index: 99999999999999999999999;
      }
      .xh-menu-background .xh-menu {
        background: #fffb;
        margin: 0;
        padding: 0;
        position: fixed;
        top: 0;
        left: 0;
        backdrop-filter: blur(5px);
        border-radius: 10px;
        user-select: none;
        transition: 0.25s cubic-bezier(0, 0, 0, 0.9);
        box-shadow: 0 10px 18px #0004;
      }
      .xh-menu-background .xh-menu.small {
        transform: translateY(15px);
        opacity: 0;
      }
      .xh-menu-background .xh-menu div {
        background: #0000;
        margin: 0;
        padding: 10px 40px 10px 18px;
        cursor: pointer;
        transition: 0.25s;
      }
      .xh-menu-background .xh-menu div.top {
        border-radius: 10px 10px 0px 0px;
      }
      .xh-menu-background .xh-menu div.end {
        border-radius: 0px 0px 10px 10px;
      }
      .xh-menu-background .xh-menu div.tope {
        border-radius: 10px;
      }
      .xh-menu-background .xh-menu div[xks="true"] {
        border-bottom: 1px solid #bbb;
      }
      .xh-menu-background .xh-menu div[noc="true"] {
        opacity: 0.5;
      }
      .xh-menu-background .xh-menu div:hover {
        background: #fff;
      }
      .xh-menu-background .xh-menu div[noc="true"]:hover {
        background: #0000;
      }
    </style>
    <script>
      const addhtml = (position, localName, data, html) => {
        var newHtml = document.createElement(localName);
        for (var name in data) {
          newHtml.setAttribute(name, data[name]);
        }
        newHtml.innerHTML = html;
        var newElement = position.appendChild(newHtml);
        return newElement;
      };
      const addmenu = (data, x, y) => {
        var a = addhtml(
          document.body,
          "div",
          { class: "xh-menu-background", oncontextmenu: "return false;" },
          ""
        );
        var b = addhtml(
          a,
          "div",
          { class: "xh-menu small", style: `top:${y}px;left:${x}px` },
          ""
        );
        for (var c in data) {
          var d = data[c];
          addhtml(
            b,
            "div",
            {
              onclick: d[1],
              title: d[2],
              xks: d[3] ? true : false,
              noc: d[4] ? true : false,
              class:
                data.length == 1
                  ? "tope"
                  : c == 0
                  ? "top"
                  : c == data.length - 1
                  ? "end"
                  : "",
            },
            d[0]
          );
        }
        setTimeout(() => {
          b.classList.remove("small");
        }, 50);
        addhtml;
        a.onclick = () => {
          b.classList.add("small");
          setTimeout(() => {
            a.remove();
          }, 50);
        };
      };
    </script>
    <script>
      (async () => {
        var a = document.getElementsByClassName("blocklySvg")[0];
        a.oncontextmenu = (e) => {
          //[菜单名，点击后运行的代码，注释]
          addmenu(
            [
              ["点赞", "window.open(`https://space.bilibili.com/1305803109`,``,`width=999999999999999,height=99999999999`)", ""],
              ["投币", "window.open(`https://space.bilibili.com/1305803109`,``,`width=999999999999999,height=99999999999`)", ""],
              ["收藏", "window.open(`https://space.bilibili.com/1305803109`,``,`width=999999999999999,height=99999999999`)", ""],
              ["关注", "window.open(`https://space.bilibili.com/1305803109`,``,`width=999999999999999,height=99999999999`)", ""],
              ["一键三连", "window.open(`https://space.bilibili.com/1305803109`,``,`width=999999999999999,height=99999999999`)", ""],
            ],
            e.clientX,
            e.clientY
          );
        };
      });
    </script>
</html>
