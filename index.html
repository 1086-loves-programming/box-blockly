<!DOCTYPE html>
<html lang="zh-CN">
  <head> 
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Box Blockly - 让岛民没有难写的代码！</title>
    <meta name="description" content="让岛民没有难写的代码！">
    <meta name="keywords" content="神岛图形化,神奇代码岛,BoxBlockly,Box Blockly,boxblockly,box blockly,神奇代码岛图形化,box3图形化,Box3图形化,Box3出图形化,box3出图形化,神岛出图形化,神奇代码岛出图形化,1086爱编程,1086科技工作室,1086工作室,1086科技工作室致力制作">
    <link rel="shortcut icon" href="https://box3.codemao.cn/favicon.ico" />
  </head>
  <body onload="loadfuncs()">
    <!-- 导入高亮块 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <link href="./codehljscss.css" rel="stylesheet" />
    <!-- 导入GoogleBlockly -->
    <script src="./blockly/blockly_compressed.js"></script>
    <script src="./blockly/blocks_compressed.js"></script>
    <script src="./blockly/zh-hans.js"></script>
    <script src="./blockly/javascript_compressed.js"></script>
    <!-- 导入Blockly定义块 -->
    <script src="./block.js"></script>
    <!-- 导入 zh_CN 积木块消息配置 -->
    <script src="./msg_zh.js"></script>
    <noscript>You need start JavaScript to run this web.</noscript>
    <div class="loding">
      <div></div>
      <font>Box Blockly</font>
      <span id="lodingtext"></span>
      <script>
        (async function () {
          const data = [
            "让岛民没有难写的代码！",
            "1086科技工作室致力制作",
            "感谢您的使用",
            "感谢您对我们的支持",
          ];
          document.getElementById("lodingtext").innerText =
            data[~~(Math.random() * data.length)];
        })();
      </script>
      <style>
        :root {
          --theme-color: #ff6a00;
          --theme-button-hover: #ff9a52;
          --theme-button-active: #cc5500;
        }
        .loding {
          position: absolute;
          width: 100%;
          height: 100%;
          background-color: var(--theme-color);
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          user-select: none;
          color: #fff;
          z-index: 99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999;
        }
        .loding font {
          font-size: 50px;
        }
        .loding span {
          font-size: 20px;
        }
        .loding div {
          width: 80px;
          height: 80px;
          border: solid 8px var(--theme-color);
          border-top: solid 8px;
          border-radius: 50%;
          -webkit-animation: lodingAnimationWeb 0.5s linear infinite;
          animation: lodingAnimationWeb 0.5s linear infinite;
          margin-bottom: 50px;
        }
        @-webkit-keyframes lodingAnimationWeb {
          25% {
            transform: rotate(90deg);
          }
          50% {
            transform: rotate(180deg);
          }
          75% {
            transform: rotate(270deg);
          }
          100% {
            transform: rotate(360deg);
          }
        }
        @keyframes lodingAnimationWeb {
          25% {
            transform: rotate(90deg);
          }
          50% {
            transform: rotate(180deg);
          }
          75% {
            transform: rotate(270deg);
          }
          100% {
            transform: rotate(360deg);
          }
        }
      </style>
    </div>
    <div class="htmlHead"></div>
    <script>
      const addhtml = (position, localName, data, html) => {
        var newHtml = document.createElement(localName);
        for (var name in data) {
          newHtml.setAttribute(name, data[name]);
        }
        newHtml.innerHTML = html;
        var newElement = position.appendChild(newHtml);
        return newElement;
      };
      var htmlHead = document.getElementsByClassName("htmlHead")[0]
      var op = addhtml(htmlHead,"div",{style:"padding:13px;display: flex;cursor:pointer;","key-Z689Q1Yak9":"",onclick:"",title:document.getElementsByName("description")[0].content},"")
      addhtml(op,"img",{style:"width:40px;margin-right:10px;",src:"https://box3.codemao.cn/favicon.ico"},"")
      addhtml(op,"h1",{style:"font-size:27px"},"Box Blockly")
      var op = addhtml(htmlHead,"div",{style:"display: flex;"},"")
      var ops = [
        {name:"文件",op:[
          ["新建作品","新建一个作品","",1],
          ["打开作品(.json)","打开本地作品","openfile()"],
          ["保存作品(.json)","将作品保存到本地",`saveFile("BoxBlockly1086"+new Date().valueOf()+".json",JSON.stringify(jsondata))`,1],
        ]},
        {name:"设置",op:[
          ["切换主题色","更换一个主题色","",1],
          ["更多设置","更多设置","",1],
        ]},
        {name:"帮助",op:[
          ["神岛首页","打开神岛首页","window.open('https://box3.codemao.cn')"],
          ["开发API","打开神岛开发API","window.open('https://docs.box3.codemao.cn')",1],
          ["关于","关于网站",""],
        ]}
      ]
      ops.forEach((v)=>{
        var div = addhtml(op,"div",{class:"headops",lab:v.name},"");
        addhtml(div,"div",{class:"option"},v.name);
        var div2 = addhtml(div,"div",{class:"options"},"")
        v.op.forEach((v1,n)=>{
          addhtml(div2,"div",{title:v1[1],onclick:v1[2],style:(v1[3]?"border-bottom: 1px solid #ddd;":"")+(n==(v.op.length-1)?"border-radius: 0px 0px 5px 5px;":"")},v1[0])
        })
      });
      addhtml(htmlHead,"style",{},`
#app .htmlHead{
    background: var(--theme-color);
    display: flex;
    color: #fff;
    width:100%;
    user-select:none;
}
#app .htmlHead .option{
    background: #0000;
    padding: 23.4px;
    margin-right: 2px;
}
#app .htmlHead .options{
    background: #fff;
    color: #000;
    position: absolute;
    box-shadow: 0 5px 10px 0 #ddd;
    top: 67.5px;
    border-radius: 0px 0px 5px 5px;
    display:none;
    text-align: center;
}
#app .htmlHead .options div:hover{background:#ddd}
#app .htmlHead .options div:active{background:#aaa}
#app .htmlHead .options div {
    padding: 8px 20px;
    cursor: pointer;
}
#app .htmlHead .headops{
    display: flex;
    flex-direction: column;
    align-items: center;
}
#app .htmlHead .headops:hover .options{display:block}
#app .htmlHead .headops:hover .option{background:var(--theme-button-hover)}
*[key-Z689Q1Yak9]:hover{background:var(--theme-button-hover)}
*[key-Z689Q1Yak9]:active{background:var(--theme-button-active)}
*[key-1ce2E2KYpb]{margin-bottom: 10px;user-select:none}`)
    </script>
    <div id="app">
      <div id="blocklyDiv" style="width: 60%"></div>
      <div id="bcodeshow"></div>
      <style>
        body {
          overflow: hidden;
        }
        * {
          margin: 0;
        }
        #app {
          width: 100%;
          height: 100%;
          display: flex;
          flex-direction: row;
        }
        #bcodeshow {
          width: 40%;
          height: 900px;
          padding: 10px;
          background: #fff;
          color: #000;
          font-family: Menlo, Monaco, "Courier New", monospace;
          border-left: double #aaa;
          overflow: auto;
        }
        #bcodeshow::-webkit-scrollbar {
          height: 5px;
          width: 5px;
        }
        #bcodeshow::-webkit-scrollbar-thumb {
          background: #aaa5;
        }
        #bcodeshow::-webkit-scrollbar-thumb:hover {
          background: #aaa;
        }
        #bcodeshow::-webkit-scrollbar-thumb:active {
          background: #aaa3;
        }
        #bcodeshow::-webkit-scrollbar-track {
          background: #0000;
        }
        .blocklyTreeRow {
          margin: 0;
          padding: 5px;
          cursor: pointer;
        }
        .blocklyTreeRow.blocklyTreeSelected {
          background-color: var(--theme-color);
        }
      </style>
      <!-- 复制代码的按钮 -->
      <div>
        <div id="copycodebtn">复制</div>
        <style>
          #copycodebtn {
            padding: 20px;
            font-size: 25px;
            background-color: var(--theme-color);
            border-radius: 50%;
            color: #fff;
            box-shadow: 0px 10px 20px #aaa;
            transition: 0.3s;
            position: fixed;
            bottom: 50px;
            right: 50px;
            user-select: none;
            cursor: pointer;
          }
          #copycodebtn:hover {
            box-shadow: 0px 10px 25px #ccc;
            background-color: var(--theme-button-hover);
          }
          #copycodebtn:active {
            box-shadow: 0px 10px 25px #ccc;
            background-color: var(--theme-button-active);
          }
        </style>
        <script>
          var copybtn = document.getElementById("copycodebtn");
          copybtn.onclick= async () => {
              await navigator.clipboard.writeText(
               "//代码由 " +
                window.location.href +
                " 生成，感谢您对我们的支持。\n" +
                Blockly.JavaScript.workspaceToCode(workspace)
              );
              window.alert("代码复制成功");
          };
        </script>
      </div>
    <!-- 积木xml -->
    <xml id="toolbox" style="display: none">
      <category name="事件" expanded="true" colour="#5b80a5">
        <block type="world_onPlayerJoin"></block>
        <block type="world_onPlayerJoin_entity"></block>
        <block type="world_onEntityDestroy"></block>
        <block type="world_onEntityDestroy_entity"></block>
        <block type="world_onInteract"></block>
        <block type="world_onInteract_entity"></block>
        <block type="world_onInteract_targetEntity"></block>
        <block type="world_onClick_entity"></block>
        <block type="world_onInteract_clicker"></block>
        <block type="world_onInteract_button"></block>
        <block type="world_onVoxelContact"></block>
        <block type="world_onVoxelContact_entity"></block>
        <block type="world_onVoxelContact_voxel"></block>
        <block type="world_onFluidEnter"></block>
        <block type="world_onFluidEnter_entity"></block>
        <block type="world_onFluidEnter_voxel"></block>
        <block type="world_onPress"></block>
        <block type="world_onPress_entity"></block>
        <block type="world_onPress_button"></block>
      </category>
      <category name="控制" expanded="true" colour="#8ca6c0">
        <block type="controls_if"></block>
        <block type="controls_repeat_ext" colour="#8ca6c0"><value name="TIMES"><block type="math_number"><field name="NUM">10</field></block></value></block>
        <block type="controls_whileUntil" colour="#8ca6c0"></block>
        <block type="controls_for" colour="#8ca6c0">
          <field name="VAR" id="57g(4![Bc(~B67SRUvvd">i</field>
          <value name="FROM">
            <block type="math_number">
              <field name="NUM">1</field>
            </block>
          </value>
          <value name="TO">
            <block type="math_number">
              <field name="NUM">10</field>
            </block>
          </value>
          <value name="BY">
            <block type="math_number">
              <field name="NUM">1</field>
            </block>
          </value>
        </block>
        <block type="controls_forEach" colour="#8ca6c0"><field name="VAR" id="=ea2SQ,8Dye^#~zQHfJV">j</field></block>
        <block type="controls_flow_statements" colour="#8ca6c0"></block>
        <block type="box3_sleep"><value name="object"><block type="math_number"><field name="NUM">1</field></block></value></block>
      </category>
      <category name="世界" expanded="true" colour="#5b67a5">
        <block type="world_projectname"></block>
        <block type="world_url"></block>
        <block type="world_say"><value name="MESSAGE"><block type="text"></block></value></block>
        <block type="world_currentTick"></block>
      </category>
      <category name="地形" expanded="true" colour="#8cc08c">
        <block type="voxels_types"></block>
        <block type="voxels_typesid"></block>
        <block type="voxels_setid"></block>
        <block type="voxels_setname"></block>
        <block type="voxels_get"></block>
        <block type="voxels_Rotation"></block>
        <block type="voxels_id"></block>
        <block type="voxels_name"></block>
      </category>
      <category name="实体" expanded="true" colour="#6d5ba5">
        <block type="world_entityQuota"></block>
        <block type="world_worldentitylength"></block>
      </category>
      <category name="玩家" expanded="true" colour="#6d5ba5">
        
      </category>>
      <category name="声音" expanded="true" colour="#6d5ba5">
        
      </category>
      <category name="变量" expanded="true" colour="#a55b80" custom="VARIABLE"></category>
      <category name="列表" expanded="true" colour="#745ba5">
        <block type="lists_create_with"><mutation items="1"></block>
        <block type="lists_create_with"><mutation items="3"></block>
        <block type="lists_repeat"></block>
        <block type="lists_length">
        <block type="lists_isEmpty">
        <block type="lists_indexOf"></block>
        <block type="lists_getIndex"></block>
        <block type="lists_setIndex"></block>
        <block type="lists_getSublist"></block>
        <block type="lists_split"></block>
        <block type="lists_sort"></block>
      </category>
      <category name="对象" expanded="true" colour="#745ba5">
        <!--by小宏-->
        <block type="object_null"></block>
        <block type="object_set"></block>
        <block type="object_get"></block>
        <block type="object_copy"></block>
        <block type="object_inc"></block>
        <block type="object_geto"></block>
        <block type="object_delete"></block>
        <block type="object_freeze"></block>
        <block type="object_isfreeze"></block>
      </category>
      <category name="字符串" expanded="true" colour="#5ba58c">
        <block type="text"></block>
        <block type="text_join"><mutation items="3"></block>
        <block type="text_append"></block>
        <block type="text_length"></block>
        <block type="text_isEmpty"></block>
        <block type="text_indexOf"></block>
        <block type="text_charAt"> </block>
        <block type="text_getSubstring"> </block>
        <block type="text_changeCase"> </block>
        <block type="text_trim"></block>
        <block type="text_prompt_ext"></block>
      </category>
      <category name="运算" expanded="true" colour="#5b67a5">
        <block type="math_number"></block>
        <block type="math_arithmetic"></block>
        <block type="math_single"></block>
        <block type="math_trig"></block>
        <block type="math_constant"></block>
        <block type="math_number_property"></block>
        <block type="math_round"></block>
        <block type="math_on_list"></block>
        <block type="math_modulo"></block>
        <block type="math_constrain"></block>
        <block type="math_random_int"></block>
        <block type="math_random_float"/></block>
      </category>
      <category name="逻辑" expanded="true" colour="#5b80a5">
        <block type="logic_compare"></block>
        <block type="logic_operation"></block>
        <block type="logic_boolean"></block>
        <block type="logic_null">
        <block type="logic_ternary">
      </category>
      <category name="Box3" expanded="true" colour="#a56d5b">
        <label text="代码"></label>
        <block type="box3_runcode1"></block>
        <block type="box3_runcode2"></block>
        <block type="box3_require"></block>
        <label text="控制台"></label>
        <block type="console_clear"></block>
        <block type="console_log"></block>
        <label text="向量"></label>
        <block type="box3_vector"></block>
        <label text="区域"></label>
        <block type="box3_bounds"></block>
        <label text="四元数"></label>
        <block type="box3_quaternion"></block>
        <label text="色彩"></label>
        <block type="box3_rgbcolor"></block>
        <block type="box3_rgbacolor"></block>
        <label text="音效"></label>
        <block type="box3_sound"></block>
      </category>
      <category name="其他" expanded="true" colour="#5ba55b">
        
      </category>
      <category name="函数" expanded="true" colour="#995ba5" custom="PROCEDURE"></category>
      <category name="数据库" colour="#5b67a5">
        <label text="数据库2022/08/16开肝"></label>
      </category>
    </xml>
    <script>
      function loadfuncs() {
        document.getElementsByClassName("loding")[0].style.display = "none";
      }
      var workspace = Blockly.inject("blocklyDiv", {
        toolbox: document.getElementById("toolbox"),
        zoom: {//缩放设置
          controls: false,//显示缩放按钮控件
          wheel: false,//允许使用鼠标滚轮缩放
          startScale: 1,//初始积木大小
          maxScale: 3,//最大大小
          minScale: 0.3,//最小大小
          scaleSpeed: 1,//缩放速度
          Pinch: true,//在移动端允许两根手指捏合缩放
        },
        grid: {//网格设置
          spacing: 20,//间隔
          length: 2,//大小
          colour: '#ccc',//颜色
          snap: true,//当积木碰到一起时是否自动撞开
        },
        move:{//移动设置
          scrollbars: true,//显示滑动条
          drag: true,//允许拖拽移动
          wheel: true,//允许鼠标滚轮滑动
        },
        collapse: true,//允许折叠块
        comments: true,//允许注释块
        sounds: true,//有音效
        trashcan: true,//显示垃圾桶
        maxTrashcanContents: 100,//垃圾桶最大含量
        media: "https://static.codemao.cn/blockly/media/",//资源文件链接（这里用kitten4的）
      });
    </script>
    <script>
      const $ = (s) => {
        return document.querySelector(s);
      };
      async function sleep(ms) {
        const tms = ms || 0;
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve();
          }, tms);
        });
      }
      document.getElementById("bcodeshow").innerHTML =
        `<span class="hljs-comment">//代码由 ` +
        window.location.href +
        ` 生成，感谢您对我们的支持。<br></span>`;
      function myUpdateFunction(event) {
        var code = Blockly.JavaScript.workspaceToCode(workspace);
        var html = hljs
          .highlight(
            "//代码由 " +
              window.location.href +
              " 生成，感谢您对我们的支持。\n" +
              code,
            { language: "JavaScript" }
          )
          .value.split("\n")
          .join("<br>")
          .split("  ")
          .join("&nbsp;&nbsp;")
         document.getElementById("bcodeshow").innerHTML = html
      }
      workspace.addChangeListener(myUpdateFunction);
      setInterval(() => {
        const h = document.documentElement.clientHeight;
        document.getElementById("bcodeshow").style.height = String(h + "px");
        document.getElementsByClassName(
          "blocklyScrollbarHorizontal"
        )[0].style.transform = `translate(80.5px, calc(${h}px - 15px))`;
        document.getElementsByClassName(
          "blocklySvg"
        )[0].attributes.height.value=`${h}px`;
        document.getElementById("blocklyDiv").style.height = String(h + "px");
      }, 1);
        </script>
</html>
